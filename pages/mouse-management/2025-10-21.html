<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratory Mouse Housing Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        /* Image Visualization Section Styles */
        .image-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        .image-title {
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .images-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .image-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid #dee2e6;
        }
        .image-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .image-item img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            cursor: pointer;
        }
        .image-item-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        .image-description {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.4;
        }
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            cursor: pointer;
        }
        .image-modal img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 95%;
            max-height: 95%;
            border-radius: 8px;
        }
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
        }
        .toggle-images {
            display: block;
            width: 200px;
            margin: 0 auto 20px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .toggle-images:hover {
            background-color: #218838;
        }
        
        /* Presentation Section Styles */
        .presentation-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        .presentation-title {
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .slides-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .slide-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid #dee2e6;
        }
        .slide-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .slide-item img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        .slide-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        .slide-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            cursor: pointer;
        }
        .slide-modal img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
        }
        .toggle-presentation {
            display: block;
            width: 200px;
            margin: 0 auto 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .toggle-presentation:hover {
            background-color: #0056b3;
        }
        
        .main-container {
            display: flex;
            gap: 20px;
        }
        .grids-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin-bottom: 30px;
        }
        .info-panel {
            width: 500px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        .area {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
        }
        .area-title {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.4em;
            color: #222;
        }
        /* Grid structure for area 1 */
        #grid1-container {
            margin: 0 auto;
            display: inline-block;
        }
        .grid1-row {
            display: flex;
        }
        .grid1-cell {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            background-color: #e9e9e9;
            position: relative;
        }
        .grid1-header {
            background-color: transparent;
            border: none;
            font-weight: bold;
            font-size: 1.1em;
        }
        .grid1-row-label {
            width: 30px;
            background-color: transparent;
            border: none;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        /* Grid structure for areas 2 and 3 */
        .grid {
            display: grid;
            grid-template-columns: 30px repeat(8, 45px);
            grid-gap: 3px;
        }
        .cell {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e9e9e9;
            border: 1px solid #ccc;
            font-size: 0.9em;
            cursor: default;
            position: relative;
        }
        .row-label {
            width: 30px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .col-label {
            background-color: transparent;
            border: none;
            font-weight: bold;
        }
        
        /* Common styles for all areas */
        .occupied {
            cursor: pointer;
            color: white;
            position: relative;
            border: 2px solid #333;
            transition: all 0.2s ease;
        }
        .occupied:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .occupied.selected {
            border: 3px solid #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .occupied::before {
            content: "●";
            font-size: 20px;
        }
        .tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 100;
            font-size: 0.85em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .occupied:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 40px;
            padding: 15px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 3px;
        }
        .legend-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        /* Genotype colors */
        .s100a8xc2c { background-color: #FF5733; }
        .ly6gxc2c { background-color: #33A1FF; }
        .lyz2xc2c { background-color: #33FF57; }
        .c2c { background-color: #FF6B9D; }
        .umt { background-color: #D433FF; }
        .mzb1 { background-color: #FFD700; }
        .wt { background-color: #96CEB4; }
        
        /* Info panel styles */
        .info-panel h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .cage-info {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .cage-info h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .cage-description {
            margin: 10px 0;
            padding: 10px;
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            border-radius: 4px;
        }
        .mouse-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.8em;
        }
        .mouse-table th {
            background-color: #007bff;
            color: white;
            padding: 4px;
            text-align: left;
            border: 1px solid #ddd;
            font-size: 0.75em;
        }
        .mouse-table td {
            padding: 3px 4px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 0.75em;
        }
        .mouse-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .mouse-table tbody tr:hover {
            background-color: #e9ecef;
        }
        .genotype-badge {
            padding: 2px 4px;
            border-radius: 3px;
            color: white;
            font-size: 0.65em;
            font-weight: bold;
        }
        .no-selection {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            margin: 50px 0;
        }
        .mouse-count {
            font-weight: bold;
            color: #007bff;
        }
        .cage-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .status-normal { background-color: #d4edda; color: #155724; }
        .status-breeding { background-color: #fff3cd; color: #856404; }
        .status-experimental { background-color: #d1ecf1; color: #0c5460; }
        .status-pending { background-color: #ffeaa7; color: #856404; }
        .status-deceased { background-color: #f8d7da; color: #721c24; }
        .status-genotyped { background-color: #d1ecf1; color: #0c5460; }
        .status-redistributed { background-color: #e2e3e5; color: #495057; }
        .treatment-info {
            background-color: #f8d7da;
            color: #721c24;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 0.9em;
        }
        .death-info {
            background-color: #f5c6cb;
            color: #721c24;
            padding: 6px;
            border-radius: 4px;
            margin: 4px 0;
            font-size: 0.8em;
        }
        .birth-death-dates {
            font-size: 0.7em;
            color: #666;
        }
        .date-header {
            text-align: center;
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #495057;
        }
        .management-note {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 0.9em;
            border-left: 4px solid #ffc107;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        /* Management Records Section Styles */
        .management-records-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        .management-records-title {
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #dc3545;
            padding-bottom: 10px;
        }
        .toggle-records {
            display: block;
            width: 200px;
            margin: 0 auto 20px;
            padding: 10px 20px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .toggle-records:hover {
            background-color: #c82333;
        }
        .records-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .record-entry {
            background-color: #f8f9fa;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .record-date {
            font-weight: bold;
            font-size: 1.1em;
            color: #dc3545;
            margin-bottom: 10px;
        }
        .record-item {
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
            line-height: 1.6;
        }
        .record-item:last-child {
            border-bottom: none;
        }
        .record-highlight {
            background-color: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <h1>Laboratory Mouse Housing Management System (C57/B6 Background)</h1>
    
    <div class="date-header">
        System Updated: October 21, 2025 | Latest Management Records Included
    </div>

    <!-- Image Visualization Section -->
    <div class="image-section">
        <div class="image-title">Research Documentation Images</div>
        <button class="toggle-images" onclick="toggleImages()">
            <span id="toggle-images-text">Show Research Images</span>
        </button>
        <div class="images-container" id="images-container" style="display: none;">
            <div class="image-item">
                <img src="image/250723/250723-1.png" alt="Research Image 1" onclick="openImageModal('image/250723/250723-1.png')" onerror="handleImageError(this, '250723-1.png')">
                <div class="image-item-title">Research Documentation 1</div>
                <div class="image-description">Laboratory research findings and experimental data visualization</div>
            </div>
            <div class="image-item">
                <img src="image/250723/250723-2.png" alt="Research Image 2" onclick="openImageModal('image/250723/250723-2.png')" onerror="handleImageError(this, '250723-2.png')">
                <div class="image-item-title">Research Documentation 2</div>
                <div class="image-description">Detailed analysis and comparative study results</div>
            </div>
            <div class="image-item">
                <img src="image/250723/250723-3.png" alt="Research Image 3" onclick="openImageModal('image/250723/250723-3.png')" onerror="handleImageError(this, '250723-3.png')">
                <div class="image-item-title">Research Documentation 3</div>
                <div class="image-description">Summary and conclusions from research activities</div>
            </div>
        </div>
    </div>

    <!-- Modal for full-size image viewing -->
    <div class="image-modal" id="imageModal" onclick="closeImageModal()">
        <span class="close-modal">&times;</span>
        <img id="modalImageImg" src="" alt="Full size image">
    </div>

    <!-- Presentation Section -->
    <div class="presentation-section">
        <div class="presentation-title">IBD Research Presentation</div>
        <button class="toggle-presentation" onclick="togglePresentation()">
            <span id="toggle-text">Show Presentation Slides</span>
        </button>
        <div class="slides-container" id="slides-container" style="display: none;">
            <div class="slide-item" onclick="openModal('slide1')">
                <img src="images2/Slide1.png" alt="Slide 1" id="slide1-thumb">
                <div class="slide-title">Slide 1</div>
            </div>
            <div class="slide-item" onclick="openModal('slide2')">
                <img src="images2/Slide2.png" alt="Slide 2" id="slide2-thumb">
                <div class="slide-title">Slide 2</div>
            </div>
            <div class="slide-item" onclick="openModal('slide3')">
                <img src="images2/Slide3.png" alt="Slide 3" id="slide3-thumb">
                <div class="slide-title">Slide 3</div>
            </div>
            <div class="slide-item" onclick="openModal('slide4')">
                <img src="images2/Slide4.png" alt="Slide 4" id="slide4-thumb">
                <div class="slide-title">Slide 4</div>
            </div>
            <div class="slide-item" onclick="openModal('slide5')">
                <img src="images2/Slide5.png" alt="Slide 5" id="slide5-thumb">
                <div class="slide-title">Slide 5</div>
            </div>
            <div class="slide-item" onclick="openModal('slide6')">
                <img src="images2/Slide6.png" alt="Slide 6" id="slide6-thumb">
                <div class="slide-title">Slide 6</div>
            </div>
        </div>
    </div>

    <!-- Modal for full-size slide viewing -->
    <div class="slide-modal" id="slideModal" onclick="closeModal()">
        <span class="close-modal">&times;</span>
        <img id="modalImg" src="" alt="Full size slide">
    </div>

    <!-- Management Records Section -->
    <div class="management-records-section">
        <div class="management-records-title">小鼠管理操作记录 (Management Operation Records)</div>
        <button class="toggle-records" onclick="toggleRecords()">
            <span id="toggle-records-text">显示管理记录</span>
        </button>
        <div class="records-container" id="records-container" style="display: none;">

            <div class="record-entry">
                <div class="record-date">2025年9月21日 (September 21, 2025)</div>
                <div class="record-item">
                    <span class="record-highlight">1-6B</span> → 分到 <span class="record-highlight">1-3G</span><br>
                    操作：1-6B空，1-3G现为c2c
                </div>
                <div class="record-item">
                    <span class="record-highlight">1-5A</span> → 分到 <span class="record-highlight">1-5D</span><br>
                    操作：1-5A保留四雄，1-5D接收雌性小鼠（1-2周龄，需确定出生日期）
                </div>
                <div class="record-item">
                    <span class="record-highlight">1-8C</span> → 分到 <span class="record-highlight">2-7B</span><br>
                    操作：1-8C保留2雌及多只幼鼠，2-7B接收2雄
                </div>
                <div class="record-item">
                    <span class="record-highlight">1-2C</span> → 分到 <span class="record-highlight">1-6B</span><br>
                    操作：1-6B接收小鼠（4-5周龄待鉴定），1-2C为ly6g基因型
                </div>
            </div>

            <div class="record-entry">
                <div class="record-date">2025年9月22日 (September 22, 2025)</div>
                <div class="record-item">
                    <span class="record-highlight">1-5D</span>：剪脚指甲（s100a8基因型）<br>
                    小鼠编号：91-100
                </div>
                <div class="record-item">
                    <span class="record-highlight">1-6B</span>：剪脚趾甲（ly6g基因型）<br>
                    小鼠编号：81-86
                </div>
            </div>

            <div class="record-entry">
                <div class="record-date">2025年9月23日 (September 23, 2025)</div>
                <div class="record-item">
                    <span class="record-highlight">2-9B</span>：剪脚指甲（ly6g基因型）
                </div>
            </div>

            <div class="record-entry">
                <div class="record-date">2025年9月25日 (September 25, 2025)</div>
                <div class="record-item">
                    <span class="record-highlight">2-9C</span>：剪脚指甲（ly6g基因型）
                </div>
                <div class="record-item">
                    <span class="record-highlight">2-8E</span>：剪脚指甲（ly6g基因型）
                </div>
            </div>

            <div class="record-entry">
                <div class="record-date">2025年10月21日 (October 21, 2025) - 大规模调整</div>
                <div class="record-item">
                    <span class="record-highlight">2-9B</span> → 分到 <span class="record-highlight">2-9B, 3-8D</span><br>
                    操作：lyz2基因型，mzb1已丢弃
                </div>
                <div class="record-item">
                    <span class="record-highlight">2-8E</span>：保留小鼠<br>
                    操作：保留52、53、54、41号及刚出生的4只（lyz2基因型）
                </div>
                <div class="record-item">
                    <span class="record-highlight">2-9C</span> → 分到 <span class="record-highlight">2-4E</span><br>
                    操作：34、36、32号（三只待鉴定）分到2-4E，2-9C保留之前的五只（lyz2基因型）
                </div>
                <div class="record-item">
                    <span class="record-highlight">1-5D</span> → 分到 <span class="record-highlight">2-7B</span> 及 <span class="record-highlight">1-5D</span><br>
                    操作：部分分配到2-7B，其余保留在1-5D
                </div>
                <div class="record-item">
                    <span class="record-highlight">1-3B</span> → 分到 <span class="record-highlight">1-8C</span> 及 <span class="record-highlight">1-3B</span><br>
                    操作：部分分配到1-8C，其余保留在1-3B
                </div>
                <div class="record-item">
                    <span class="record-highlight">2-1A</span> → 小崽分到 <span class="record-highlight">1-2C</span><br>
                    操作：2-1A现已清空
                </div>
                <div class="record-item">
                    <strong>笼位清理总结：</strong><br>
                    • <span class="record-highlight">2-8E</span>：只保留9.24鉴定好的小鼠和刚出生的小鼠（4只成体），其他丢弃<br>
                    • <span class="record-highlight">2-9C</span>：保留之前的五只小鼠，9.24刚鉴定好的和刚出生的分到2-4E（6只，3+3）<br>
                    • <span class="record-highlight">2-9B</span>：部分分到3-8D<br>
                    • 清空笼位：原2-1A、原2-7B、原2-4E、原1-8C已清空<br>
                    • <span class="record-highlight">3-8D</span>：原MZB1已丢弃<br>
                    • <span class="record-highlight">1-2C</span>：小崽部分来自2-1A<br>
                    • <span class="record-highlight">1-3B</span>：部分分到1-8C<br>
                    • <span class="record-highlight">1-5D</span>：部分分到2-7B<br>
                    • <span class="record-highlight">2-1A</span>：已清空
                </div>
            </div>

        </div>
    </div>

    <div class="main-container">
        <div class="grids-container">
            <div class="area">
                <div class="area-title">Area 1: A-G × 9-1</div>
                <div id="grid1-container"></div>
            </div>
            
            <div class="area">
                <div class="area-title">Area 2: A-H × 9-1</div>
                <div class="grid" id="grid2"></div>
            </div>
            
            <div class="area">
                <div class="area-title">Area 3: A-H × 9-1</div>
                <div class="grid" id="grid3"></div>
            </div>
        </div>

        <div class="info-panel">
            <h3>Cage Information</h3>
            <div id="cage-details">
                <div class="no-selection">
                    Click on any occupied cage to view detailed mouse information
                </div>
            </div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-title">Mouse Genotype Legend</div>
        <div class="legend-item">
            <div class="legend-color s100a8xc2c"></div>
            <span>S100a8 x c2c</span>
        </div>
        <div class="legend-item">
            <div class="legend-color ly6gxc2c"></div>
            <span>Ly6g x c2c</span>
        </div>
        <div class="legend-item">
            <div class="legend-color lyz2xc2c"></div>
            <span>Lyz2 x c2c</span>
        </div>
        <div class="legend-item">
            <div class="legend-color c2c"></div>
            <span>c2c</span>
        </div>
        <div class="legend-item">
            <div class="legend-color umt"></div>
            <span>umt</span>
        </div>
        <div class="legend-item">
            <div class="legend-color mzb1"></div>
            <span>mzb1</span>
        </div>
        <div class="legend-item">
            <div class="legend-color wt"></div>
            <span>WT (C57/B6)</span>
        </div>
    </div>

    <script>
        // Function to calculate age in weeks with 2 decimal precision
        function calculateAge(birthDate) {
            const today = new Date('2025-09-17');
            const birth = new Date(birthDate);
            const diffTime = today - birth;
            const ageInWeeks = diffTime / (1000 * 60 * 60 * 24 * 7);
            return ageInWeeks.toFixed(2);
        }

        // Image functionality
        function toggleImages() {
            const container = document.getElementById('images-container');
            const toggleButton = document.getElementById('toggle-images-text');
            
            if (container.style.display === 'none') {
                container.style.display = 'grid';
                toggleButton.textContent = 'Hide Research Images';
            } else {
                container.style.display = 'none';
                toggleButton.textContent = 'Show Research Images';
            }
        }

        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImageImg');
            
            modalImg.src = imageSrc;
            modal.style.display = 'block';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }

        function handleImageError(img, filename) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <strong>Image Load Error:</strong><br>
                Unable to load ${filename}<br>
                <small>Please ensure the image file exists in the correct directory path.</small>
            `;
            img.parentNode.replaceChild(errorDiv, img);
        }

        // Presentation functionality
        function togglePresentation() {
            const container = document.getElementById('slides-container');
            const toggleButton = document.getElementById('toggle-text');

            if (container.style.display === 'none') {
                container.style.display = 'grid';
                toggleButton.textContent = 'Hide Presentation Slides';
            } else {
                container.style.display = 'none';
                toggleButton.textContent = 'Show Presentation Slides';
            }
        }

        // Management Records functionality
        function toggleRecords() {
            const container = document.getElementById('records-container');
            const toggleButton = document.getElementById('toggle-records-text');

            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggleButton.textContent = '隐藏管理记录';
            } else {
                container.style.display = 'none';
                toggleButton.textContent = '显示管理记录';
            }
        }

        function openModal(slideId) {
            const modal = document.getElementById('slideModal');
            const modalImg = document.getElementById('modalImg');
            const slideNumber = slideId.replace('slide', '');
            
            modalImg.src = `images2/Slide${slideNumber}.png`;
            modal.style.display = 'block';
        }

        function closeModal() {
            const modal = document.getElementById('slideModal');
            modal.style.display = 'none';
        }

        // Close modals on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closeImageModal();
            }
        });

        // Updated cage data with all management changes - July 20, 2025
        const cageData = {
            // Area 1 cages - UPDATED AFTER MANAGEMENT
            "1-5A": {
                genotype: "s100a8xc2c",
                description: "保留已鉴定小鼠：1、3、4、5、6、9、15号，位置不变。新增未鉴定小鼠：5只1周龄、5只1.5周龄",
                status: "Mixed Population with New Unidentified Mice",
                mice: [
                    { id: "1-5A-01", genotype: "c2c+/+s100a8+/-DTR+/-", sex: "Male", birthDate: "2025-04-25", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-03", genotype: "c2c+/-s100a8+/-DTR+/-", sex: "Male", birthDate: "2025-06-26", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-04", genotype: "c2c+/+s100a8+/-DTR+/-", sex: "Male", birthDate: "2025-06-25", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-05", genotype: "c2c+/+s100a8+/-DTR+/-", sex: "Male", birthDate: "2025-06-24", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-06", genotype: "c2c+/+DTR+/+", sex: "Female", birthDate: "2025-06-03", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-09", genotype: "c2c+/+s100a8+/-DTR+/-", sex: "Female", birthDate: "2025-06-23", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-15", genotype: "c2c+/+s100a8+/-DTR+/-", sex: "Female", birthDate: "2025-06-20", deathDate: "", treatment: "无", notes: "位置不变" },
                    { id: "1-5A-U1", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-10", deathDate: "", treatment: "无", notes: "高价值-1周龄" },
                    { id: "1-5A-U2", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-10", deathDate: "", treatment: "无", notes: "高价值-1周龄" },
                    { id: "1-5A-U3", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-10", deathDate: "", treatment: "无", notes: "高价值-1周龄" },
                    { id: "1-5A-U4", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-10", deathDate: "", treatment: "无", notes: "高价值-1周龄" },
                    { id: "1-5A-U5", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-10", deathDate: "", treatment: "无", notes: "高价值-1周龄" },
                    { id: "1-5A-U6", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-03", deathDate: "", treatment: "无", notes: "高价值-1.5周龄" },
                    { id: "1-5A-U7", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-03", deathDate: "", treatment: "无", notes: "高价值-1.5周龄" },
                    { id: "1-5A-U8", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-03", deathDate: "", treatment: "无", notes: "高价值-1.5周龄" },
                    { id: "1-5A-U9", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-03", deathDate: "", treatment: "无", notes: "高价值-1.5周龄" },
                    { id: "1-5A-U10", genotype: "待鉴定", sex: "未知", birthDate: "2025-09-03", deathDate: "", treatment: "无", notes: "高价值-1.5周龄" }
                ],
                additionalInfo: "目前共17只小鼠，保留原有7只已鉴定小鼠，新增10只待鉴定小鼠（5只1周龄+5只1.5周龄，均为高价值）"
            },
            "1-8F": {
                genotype: "ly6gxc2c",
                description: "Ly6g x c2c、c2c x DTR 原笼种鼠",
                status: "Breeding Colony",
                mice: [
                    { id: "1-8F-01", genotype: "c2c x DTR", sex: "Male", birthDate: "2024-03-18", deathDate: "", treatment: "无", notes: "种鼠" },
                    { id: "1-8F-02", genotype: "c2c x DTR", sex: "Male", birthDate: "2024-03-10", deathDate: "", treatment: "无", notes: "种鼠" },
                    { id: "1-8F-03", genotype: "c2c x DTR", sex: "Male", birthDate: "2024-03-16", deathDate: "", treatment: "无", notes: "种鼠" },
                    { id: "1-8F-04", genotype: "Ly6g x c2c", sex: "Female", birthDate: "2024-03-22", deathDate: "", treatment: "无", notes: "种鼠" }
                ]
            },
            "1-2F": {
                genotype: "lyz2xc2c",
                description: "4只雄鼠来源于2-7B",
                status: "Males from 2-7B",
                mice: [
                    { id: "1-2F-01", genotype: "Lyz2 x c2c", sex: "Male", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "来源于2-7B" },
                    { id: "1-2F-02", genotype: "Lyz2 x c2c", sex: "Male", birthDate: "2025-07-03", deathDate: "", treatment: "无", notes: "来源于2-7B" },
                    { id: "1-2F-03", genotype: "Lyz2 x c2c", sex: "Male", birthDate: "2025-07-05", deathDate: "", treatment: "无", notes: "来源于2-7B" },
                    { id: "1-2F-04", genotype: "Lyz2 x c2c", sex: "Male", birthDate: "2025-07-07", deathDate: "", treatment: "无", notes: "来源于2-7B" }
                ]
            },
            "1-6B": {
                genotype: "c2c",
                description: "c2c 保种繁殖群，CL处理组雄性小鼠，原6只现剩2只（13、15号）",
                status: "CL Treatment Group - Survivors",
                mice: [
                    { id: "1-6B-13", genotype: "c2c", sex: "Male", birthDate: "2024-10-18", deathDate: "", treatment: "CL", notes: "CL处理组存活" },
                    { id: "1-6B-15", genotype: "c2c", sex: "Male", birthDate: "2024-10-08", deathDate: "", treatment: "CL", notes: "CL处理组存活" }
                ],
                deaths: [
                    { id: "1-6B-D1", birthDate: "2024-10-18", deathDate: "2025-04-22" },
                    { id: "1-6B-D2", birthDate: "2024-10-18", deathDate: "2025-05-27" },
                    { id: "1-6B-D3", birthDate: "2024-10-18", deathDate: "2025-07-01" },
                    { id: "1-6B-D4", birthDate: "2024-10-18", deathDate: "2025-08-09" }
                ]
            },
            "1-3B": {
                genotype: "ly6gxc2c",
                description: "Ly6g x c2c、c2c x DTR 杂交后代，4雄2雌，杂交F1代",
                status: "Pending Genotyping - F1 Generation",
                mice: [
                    { id: "1-3B-01", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Male", birthDate: "2025-06-05", deathDate: "", treatment: "无", notes: "杂交F1代（低价值）" },
                    { id: "1-3B-02", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Female", birthDate: "2025-06-06", deathDate: "", treatment: "无", notes: "杂交F1代（低价值）" },
                    { id: "1-3B-03", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Male", birthDate: "2025-06-07", deathDate: "", treatment: "无", notes: "杂交F1代（低价值）" },
                    { id: "1-3B-04", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Female", birthDate: "2025-06-04", deathDate: "", treatment: "无", notes: "杂交F1代（低价值）" },
                    { id: "1-3B-05", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Male", birthDate: "2025-06-08", deathDate: "", treatment: "无", notes: "杂交F1代（低价值）" },
                    { id: "1-3B-06", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Male", birthDate: "2025-06-09", deathDate: "", treatment: "无", notes: "杂交F1代（低价值）" }
                ]
            },
            "1-8C": {
                genotype: "ly6gxc2c",
                description: "4只待鉴定的1-8F来源的杂交F1代，又生了4只小的",
                status: "F1 Generation from 1-8F with Offspring",
                mice: [
                    { id: "1-8C-01", genotype: "待鉴定 (1-8F来源杂交F1代)", sex: "Male", birthDate: "2024-11-13", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "1-8C-02", genotype: "待鉴定 (1-8F来源杂交F1代)", sex: "Female", birthDate: "2024-11-07", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "1-8C-03", genotype: "待鉴定 (1-8F来源杂交F1代)", sex: "Male", birthDate: "2024-11-15", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "1-8C-04", genotype: "待鉴定 (1-8F来源杂交F1代)", sex: "Female", birthDate: "2024-11-10", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "1-8C-N1", genotype: "待鉴定 (F2代)", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠（低价值）" },
                    { id: "1-8C-N2", genotype: "待鉴定 (F2代)", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠（低价值）" },
                    { id: "1-8C-N3", genotype: "待鉴定 (F2代)", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠（低价值）" },
                    { id: "1-8C-N4", genotype: "待鉴定 (F2代)", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠（低价值）" }
                ]
            },
            "1-2C": {
                genotype: "ly6gxc2c",
                description: "C2C+/+ly6g+/-DTR+/-种雄鼠死亡，从2-1A引入两只雄鼠：3号c2c+/+ly6g+/-，2号ly6g+/-DTR+/+。种雌鼠生了6只小鼠",
                status: "Breeding Colony with New Males and Offspring",
                mice: [
                    { id: "1-2C-03", genotype: "c2c+/+ly6g+/-", sex: "Male", birthDate: "2025-06-08", deathDate: "", treatment: "无", notes: "从2-1A引入的种雄" },
                    { id: "1-2C-02", genotype: "ly6g+/-DTR+/+", sex: "Male", birthDate: "2025-06-05", deathDate: "", treatment: "无", notes: "从2-1A引入的种雄" },
                    { id: "1-2C-07", genotype: "ly6g+/+DTR+/-", sex: "Female", birthDate: "2025-06-20", deathDate: "", treatment: "无", notes: "种雌鼠" },
                    { id: "1-2C-N1", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-15", deathDate: "", treatment: "无", notes: "新生小鼠（高价值）" },
                    { id: "1-2C-N2", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-15", deathDate: "", treatment: "无", notes: "新生小鼠（高价值）" },
                    { id: "1-2C-N3", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-15", deathDate: "", treatment: "无", notes: "新生小鼠（高价值）" },
                    { id: "1-2C-N4", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-15", deathDate: "", treatment: "无", notes: "新生小鼠（高价值）" },
                    { id: "1-2C-N5", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-15", deathDate: "", treatment: "无", notes: "新生小鼠（高价值）" },
                    { id: "1-2C-N6", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-15", deathDate: "", treatment: "无", notes: "新生小鼠（高价值）" }
                ],
                deaths: [
                    { id: "1-2C-D1", birthDate: "2025-06-16", deathDate: "2025-08-10" }
                ],
                managementNote: "原种雄C2C+/+ly6g+/-DTR+/-死亡，从2-1A引入2只新种雄，种雌生产6只小鼠"
            },
            "1-5D": {
                genotype: "ly6gxc2c",
                description: "只剩1只杂交F1代，待基因型鉴定",
                status: "Single F1 Individual",
                mice: [
                    { id: "1-5D-01", genotype: "待鉴定 (Ly6gxc2c/c2cxDTR后代)", sex: "Male", birthDate: "2024-03-26", deathDate: "", treatment: "无", notes: "杂交F1代（极低价值）" }
                ],
                deaths: [
                    { id: "1-5D-D1", birthDate: "2024-04-01", deathDate: "2025-07-15" },
                    { id: "1-5D-D2", birthDate: "2024-03-27", deathDate: "2025-07-20" },
                    { id: "1-5D-D3", birthDate: "2024-03-30", deathDate: "2025-08-01" },
                    { id: "1-5D-D4", birthDate: "2024-03-25", deathDate: "2025-08-05" },
                    { id: "1-5D-D5", birthDate: "2024-04-02", deathDate: "2025-08-10" }
                ]
            },
            "1-1D": {
                genotype: "umt",
                description: "umt 小鼠群",
                status: "UMT Group",
                mice: [
                    { id: "1-1D-01", genotype: "umt", sex: "Male", birthDate: "2025-04-30", deathDate: "", treatment: "无", notes: "健康" },
                    { id: "1-1D-02", genotype: "umt", sex: "Female", birthDate: "2025-05-01", deathDate: "", treatment: "无", notes: "健康" },
                    { id: "1-1D-03", genotype: "umt", sex: "Male", birthDate: "2025-05-02", deathDate: "", treatment: "无", notes: "健康" },
                    { id: "1-1D-04", genotype: "umt", sex: "Female", birthDate: "2025-05-03", deathDate: "", treatment: "无", notes: "健康" }
                ]
            },
            "1-2G": {
                genotype: "c2c",
                description: "c2c雄性小鼠，PBS对照组，原6只现剩4只",
                status: "PBS Control Group - Survivors",
                mice: [
                    { id: "1-2G-01", genotype: "c2c", sex: "Male", birthDate: "2024-10-25", deathDate: "", treatment: "PBS", notes: "对照组存活" },
                    { id: "1-2G-02", genotype: "c2c", sex: "Male", birthDate: "2024-10-25", deathDate: "", treatment: "PBS", notes: "对照组存活" },
                    { id: "1-2G-03", genotype: "c2c", sex: "Male", birthDate: "2024-10-25", deathDate: "", treatment: "PBS", notes: "对照组存活" },
                    { id: "1-2G-04", genotype: "c2c", sex: "Male", birthDate: "2024-10-25", deathDate: "", treatment: "PBS", notes: "对照组存活" }
                ],
                deaths: [
                    { id: "1-2G-D1", birthDate: "2024-10-25", deathDate: "2025-07-22" },
                    { id: "1-2G-D2", birthDate: "2024-10-25", deathDate: "2025-09-16" }
                ]
            },
            "1-3G": {
                genotype: "c2c",
                description: "c2c雌性小鼠，现剩3只：2只PBS处理的c2c，1只保种的c2c",
                status: "PBS Treated + Breeding (Survivors)",
                mice: [
                    { id: "1-3G-01", genotype: "c2c", sex: "Female", birthDate: "2024-10-25", deathDate: "", treatment: "PBS", notes: "PBS处理组存活" },
                    { id: "1-3G-02", genotype: "c2c", sex: "Female", birthDate: "2024-10-25", deathDate: "", treatment: "PBS", notes: "PBS处理组存活" },
                    { id: "1-3G-03", genotype: "c2c", sex: "Female", birthDate: "2024-10-25", deathDate: "", treatment: "无", notes: "保种存活" }
                ],
                deaths: [
                    { id: "1-3G-D1", birthDate: "2024-10-08", deathDate: "2025-04-22" },
                    { id: "1-3G-D2", birthDate: "2024-10-18", deathDate: "2025-06-10" },
                    { id: "1-3G-D3", birthDate: "2024-10-18", deathDate: "2025-06-24" },
                    { id: "1-3G-D4", birthDate: "2024-10-25", deathDate: "2025-06-10" },
                    { id: "1-3G-D5", birthDate: "2024-10-25", deathDate: "?" }
                ]
            },
            "1-3A": {
                genotype: "s100a8xc2c",
                description: "从1-5A转来的N1-N8小鼠，其中只剩下7只，未确定死了哪个编号",
                status: "Transferred from 1-5A",
                mice: [
                    { id: "1-3A-N1", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" },
                    { id: "1-3A-N2", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-02", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" },
                    { id: "1-3A-N3", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-03", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" },
                    { id: "1-3A-N4", genotype: "待鉴定", sex: "未知", birthDate: "2025-06-30", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" },
                    { id: "1-3A-N5", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-04", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" },
                    { id: "1-3A-N6", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-05", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" },
                    { id: "1-3A-N7", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-06", deathDate: "", treatment: "无", notes: "1-5A转来，未鉴定（中价值）" }
                ],
                managementNote: "原来为1-5A的N1-N8小鼠，其中1只死亡（编号未确定），目前剩余7只"
            },
            
            // Area 2 cages - UPDATED AFTER MANAGEMENT
            "2-1A": {
                genotype: "ly6gxc2c",
                description: "7只小鼠来源于1-3B，待鉴定",
                status: "Offspring from 1-3B",
                mice: [
                    { id: "2-1A-01", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-1A-02", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-1A-03", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-1A-04", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-1A-05", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-1A-06", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-1A-07", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-20", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" }
                ],
                managementNote: "原小鼠已转移至1-2C，现容纳7只来自1-3B的小鼠"
            },
            "2-9B": {
                genotype: "lyz2xc2c",
                description: "大的7只成体（5雌1雄或调整组合），生了十几只小鼠。保留22号雄鼠，引入6号雌鼠来自1-3A，其余雌鼠来自2-7B",
                status: "Breeding Colony with Offspring",
                mice: [
                    { id: "2-9B-22", genotype: "lyz2+/-; DTR+/-", sex: "Male", birthDate: "2024-04-11", deathDate: "", treatment: "无", notes: "保留种雄" },
                    { id: "2-9B-06", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-07-15", deathDate: "", treatment: "无", notes: "来自1-3A的雌鼠" },
                    { id: "2-9B-F1", genotype: "c2c+/+lyz2+/-", sex: "Female", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "来自2-7B的雌鼠" },
                    { id: "2-9B-F2", genotype: "c2c+/+lyz2+/-", sex: "Female", birthDate: "2025-07-03", deathDate: "", treatment: "无", notes: "来自2-7B的雌鼠" },
                    { id: "2-9B-F3", genotype: "c2c+/+lyz2+/-", sex: "Female", birthDate: "2025-07-05", deathDate: "", treatment: "无", notes: "来自2-7B的雌鼠" },
                    { id: "2-9B-F4", genotype: "c2c+/+lyz2+/-", sex: "Female", birthDate: "2025-07-07", deathDate: "", treatment: "无", notes: "来自2-7B的雌鼠" },
                    { id: "2-9B-F5", genotype: "c2c+/+lyz2+/-", sex: "Female", birthDate: "2025-07-09", deathDate: "", treatment: "无", notes: "来自2-7B的雌鼠" },
                    { id: "2-9B-N1", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠1" },
                    { id: "2-9B-N2", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠2" },
                    { id: "2-9B-N3", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠3" },
                    { id: "2-9B-N4", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠4" },
                    { id: "2-9B-N5", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠5" },
                    { id: "2-9B-N6", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠6" },
                    { id: "2-9B-N7", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠7" },
                    { id: "2-9B-N8", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠8" },
                    { id: "2-9B-N9", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠9" },
                    { id: "2-9B-N10", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠10" },
                    { id: "2-9B-N11", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠11" },
                    { id: "2-9B-N12", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-01", deathDate: "", treatment: "无", notes: "新生小鼠12" }
                ],
                managementNote: "保留22号雄鼠作为种雄，从1-3A引入6号雌鼠，从2-7B引入多只雌鼠，已繁殖出十几只小鼠"
            },
            "2-7B": {
                genotype: "ly6gxc2c",
                description: "6只小鼠来源于1-3B，待鉴定",
                status: "Offspring from 1-3B",
                mice: [
                    { id: "2-7B-01", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-25", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-7B-02", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-25", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-7B-03", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-25", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-7B-04", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-25", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-7B-05", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-25", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" },
                    { id: "2-7B-06", genotype: "待鉴定 (1-3B来源)", sex: "未知", birthDate: "2025-08-25", deathDate: "", treatment: "无", notes: "待鉴定（低价值）" }
                ],
                managementNote: "原来自2-4E的小鼠已转移（部分到1-2F），现容纳6只来自1-3B的小鼠"
            },
            "2-9C": {
                genotype: "lyz2xc2c",
                description: "4雌1雄保留组合，已繁殖出生10几只小鼠。5号雄鼠（C2C+/+;lyz2+/-;DTR+/-），4、6、7、8号雌鼠（lyz2+/-），引入2-4E的8=10号雌鼠（C2C+/+; lyz2+/-）",
                status: "Breeding Colony with Offspring",
                mice: [
                    { id: "2-9C-05", genotype: "C2C+/+;lyz2+/-;DTR+/-", sex: "Male", birthDate: "2025-07-09", deathDate: "", treatment: "无", notes: "保留雄鼠-三基因型" },
                    { id: "2-9C-04", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-07-08", deathDate: "", treatment: "无", notes: "保留雌鼠" },
                    { id: "2-9C-06", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-07-10", deathDate: "", treatment: "无", notes: "保留雌鼠" },
                    { id: "2-9C-07", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-07-11", deathDate: "", treatment: "无", notes: "保留雌鼠-已产仔" },
                    { id: "2-9C-08", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-07-12", deathDate: "", treatment: "无", notes: "保留雌鼠" },
                    { id: "2-9C-10", genotype: "C2C+/+; lyz2+/-", sex: "Female", birthDate: "2025-06-06", deathDate: "", treatment: "无", notes: "从2-4E引入的雌鼠（原8=10号）" },
                    { id: "2-9C-N1", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠1" },
                    { id: "2-9C-N2", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠2" },
                    { id: "2-9C-N3", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠3" },
                    { id: "2-9C-N4", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠4" },
                    { id: "2-9C-N5", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠5" },
                    { id: "2-9C-N6", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠6" },
                    { id: "2-9C-N7", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠7" },
                    { id: "2-9C-N8", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠8" },
                    { id: "2-9C-N9", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠9" },
                    { id: "2-9C-N10", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠10" },
                    { id: "2-9C-N11", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠11" },
                    { id: "2-9C-N12", genotype: "待鉴定", sex: "未知", birthDate: "2025-08-05", deathDate: "", treatment: "无", notes: "新生小鼠12" }
                ],
                deaths: [
                    { id: "2-9C-D1", birthDate: "2025-07-05", deathDate: "2025-09-15" },
                    { id: "2-9C-D2", birthDate: "2025-07-06", deathDate: "2025-09-15" },
                    { id: "2-9C-D3", birthDate: "2025-07-07", deathDate: "2025-09-15" }
                ],
                managementNote: "扔掉1、2、3号雄鼠，保留特定基因型个体，从2-4E引入8=10号雌鼠，已繁殖出12只新生小鼠"
            },
            "2-4E": {
                genotype: "lyz2xc2c",
                description: "6只小鼠，待鉴定",
                status: "Pending Genotyping",
                mice: [
                    { id: "2-4E-01", genotype: "待鉴定", sex: "Male", birthDate: "2025-06-01", deathDate: "", treatment: "无", notes: "待鉴定" },
                    { id: "2-4E-02", genotype: "待鉴定", sex: "Male", birthDate: "2025-06-02", deathDate: "", treatment: "无", notes: "待鉴定" },
                    { id: "2-4E-03", genotype: "待鉴定", sex: "Female", birthDate: "2025-06-03", deathDate: "", treatment: "无", notes: "待鉴定" },
                    { id: "2-4E-04", genotype: "待鉴定", sex: "Female", birthDate: "2025-06-04", deathDate: "", treatment: "无", notes: "待鉴定" },
                    { id: "2-4E-05", genotype: "待鉴定", sex: "Female", birthDate: "2025-06-05", deathDate: "", treatment: "无", notes: "待鉴定" },
                    { id: "2-4E-07", genotype: "待鉴定", sex: "Female", birthDate: "2025-06-07", deathDate: "", treatment: "无", notes: "待鉴定" }
                ],
                managementNote: "原8=10号雌鼠已转移至2-9C，保留6只待鉴定小鼠"
            },
            "2-8E": {
                genotype: "lyz2xc2c",
                description: "6只成体小鼠，年龄很大了，生了一堆小鼠（十几只），待鉴定",
                status: "Breeding Colony with Large Offspring",
                mice: [
                    { id: "2-8E-01", genotype: "DTR+/-", sex: "Female", birthDate: "2025-06-01", deathDate: "", treatment: "无", notes: "成体雌鼠-年龄大" },
                    { id: "2-8E-02", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-06-02", deathDate: "", treatment: "无", notes: "成体雌鼠-年龄大" },
                    { id: "2-8E-03", genotype: "WT", sex: "Male", birthDate: "2025-06-03", deathDate: "", treatment: "无", notes: "成体雄鼠-年龄大" },
                    { id: "2-8E-04", genotype: "DTR+/-", sex: "Male", birthDate: "2025-06-04", deathDate: "", treatment: "无", notes: "成体雄鼠-年龄大" },
                    { id: "2-8E-05", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-06-05", deathDate: "", treatment: "无", notes: "成体雌鼠-年龄大" },
                    { id: "2-8E-06", genotype: "lyz2+/-", sex: "Female", birthDate: "2025-06-06", deathDate: "", treatment: "无", notes: "成体雌鼠-年龄大" },
                    { id: "2-8E-N1", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代1" },
                    { id: "2-8E-N2", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代2" },
                    { id: "2-8E-N3", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代3" },
                    { id: "2-8E-N4", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代4" },
                    { id: "2-8E-N5", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代5" },
                    { id: "2-8E-N6", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代6" },
                    { id: "2-8E-N7", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代7" },
                    { id: "2-8E-N8", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代8" },
                    { id: "2-8E-N9", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代9" },
                    { id: "2-8E-N10", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代10" },
                    { id: "2-8E-N11", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代11" },
                    { id: "2-8E-N12", genotype: "待鉴定", sex: "未知", birthDate: "2025-07-01", deathDate: "", treatment: "无", notes: "大龄繁殖后代12" }
                ],
                managementNote: "6只成体小鼠年龄很大，繁殖出十几只待鉴定后代"
            },
            
            // Area 3 cages - UNCHANGED
            "3-8D": {
                genotype: "mzb1",
                description: "mzb1 实验小鼠",
                status: "MZB1 Experimental",
                mice: [
                    { id: "3-8D-01", genotype: "mzb1", sex: "Male", birthDate: "2024-04-02", deathDate: "", treatment: "无", notes: "实验组" },
                    { id: "3-8D-02", genotype: "mzb1", sex: "Female", birthDate: "2024-04-05", deathDate: "", treatment: "无", notes: "实验组" },
                    { id: "3-8D-03", genotype: "mzb1", sex: "Male", birthDate: "2024-04-01", deathDate: "", treatment: "无", notes: "实验组" },
                    { id: "3-8D-04", genotype: "mzb1", sex: "Female", birthDate: "2024-04-07", deathDate: "", treatment: "无", notes: "实验组" },
                    { id: "3-8D-05", genotype: "mzb1", sex: "Male", birthDate: "2024-04-03", deathDate: "", treatment: "无", notes: "实验组" }
                ]
            },
            "3-6C": {
                genotype: "wt",
                description: "C57/B6 野生型小鼠，共8只",
                status: "Wild Type Control",
                mice: [
                    { id: "3-6C-01", genotype: "WT (C57/B6)", sex: "Male", birthDate: "2024-04-09", deathDate: "", treatment: "无", notes: "野生型对照" },
                    { id: "3-6C-02", genotype: "WT (C57/B6)", sex: "Male", birthDate: "2024-04-08", deathDate: "", treatment: "无", notes: "野生型对照" },
                    { id: "3-6C-03", genotype: "WT (C57/B6)", sex: "Female", birthDate: "2024-04-11", deathDate: "", treatment: "无", notes: "野生型对照" },
                    { id: "3-6C-04", genotype: "WT (C57/B6)", sex: "Female", birthDate: "2024-04-07", deathDate: "", treatment: "无", notes: "野生型对照" },
                    { id: "3-6C-05", genotype: "WT (C57/B6)", sex: "Female", birthDate: "2024-04-10", deathDate: "", treatment: "无", notes: "野生型对照" },
                    { id: "3-6C-06", genotype: "WT (C57/B6)", sex: "Female", birthDate: "2025-05-28", deathDate: "", treatment: "无", notes: "野生型对照-幼体" },
                    { id: "3-6C-07", genotype: "WT (C57/B6)", sex: "Male", birthDate: "2024-04-12", deathDate: "", treatment: "无", notes: "野生型对照" },
                    { id: "3-6C-08", genotype: "WT (C57/B6)", sex: "Female", birthDate: "2024-04-13", deathDate: "", treatment: "无", notes: "野生型对照" }
                ]
            }
        };

        // Add calculated ages to all mice
        Object.keys(cageData).forEach(cageId => {
            cageData[cageId].mice.forEach(mouse => {
                mouse.age = calculateAge(mouse.birthDate) + "周";
            });
        });

        let selectedCage = null;

        // Create Area 1 grid manually with a new approach
        function createGrid1() {
            const container = document.getElementById('grid1-container');
            const columns = ['', 'A', 'B', 'C', 'D', 'E', 'F', 'G'];
            const rows = ['9', '8', '7', '6', '5', '4', '3', '2', '1'];
            
            // Create header row
            const headerRow = document.createElement('div');
            headerRow.className = 'grid1-row';
            
            columns.forEach(col => {
                const cell = document.createElement('div');
                cell.className = 'grid1-cell grid1-header';
                cell.textContent = col;
                headerRow.appendChild(cell);
            });
            
            container.appendChild(headerRow);
            
            // Create data rows
            rows.forEach(row => {
                const dataRow = document.createElement('div');
                dataRow.className = 'grid1-row';
                
                // Row label first
                const rowLabel = document.createElement('div');
                rowLabel.className = 'grid1-cell grid1-row-label';
                rowLabel.textContent = row;
                dataRow.appendChild(rowLabel);
                
                // Then cells for each column
                for (let col = 1; col < columns.length; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid1-cell';
                    
                    // Check if this cell has a mouse
                    const cellId = `1-${row}${columns[col]}`;
                    
                    if (cellId in cageData) {
                        cell.className = `grid1-cell occupied ${cageData[cellId].genotype}`;
                        cell.setAttribute('data-cage-id', cellId);
                        cell.addEventListener('click', () => selectCage(cellId));
                        
                        // Add tooltip
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        const mouseCount = cageData[cellId].mice.length;
                        tooltip.textContent = `${cellId}: ${mouseCount}只 (${cageData[cellId].status})`;
                        cell.appendChild(tooltip);
                    }
                    
                    dataRow.appendChild(cell);
                }
                
                container.appendChild(dataRow);
            });
        }

        // Create the grids for areas 2 and 3
        function createGridStandard(gridId, cols, rows) {
            const grid = document.getElementById(gridId);
            
            // Create column labels (A, B, C, etc.)
            grid.appendChild(document.createElement("div")); // Empty cell for top-left corner
            for (let col = 0; col < cols.length; col++) {
                const colLabel = document.createElement("div");
                colLabel.className = "cell col-label";
                colLabel.textContent = cols[col];
                grid.appendChild(colLabel);
            }
            
            // Create rows with labels and cells
            for (let row = 0; row < rows.length; row++) {
                // Row label
                const rowLabel = document.createElement("div");
                rowLabel.className = "row-label";
                rowLabel.textContent = rows[row];
                grid.appendChild(rowLabel);
                
                // Cells in the row
                for (let col = 0; col < cols.length; col++) {
                    const cell = document.createElement("div");
                    cell.className = "cell";
                    
                    // Check if this cell has a mouse
                    const areaNumber = gridId.replace("grid", "");
                    const cellId = `${areaNumber}-${rows[row]}${cols[col]}`;
                    
                    if (cellId in cageData) {
                        cell.className = `cell occupied ${cageData[cellId].genotype}`;
                        cell.setAttribute('data-cage-id', cellId);
                        cell.addEventListener('click', () => selectCage(cellId));
                        
                        // Add tooltip
                        const tooltip = document.createElement("div");
                        tooltip.className = "tooltip";
                        const mouseCount = cageData[cellId].mice.length;
                        tooltip.textContent = `${cellId}: ${mouseCount}只 (${cageData[cellId].status})`;
                        cell.appendChild(tooltip);
                    }
                    
                    grid.appendChild(cell);
                }
            }
        }

        function selectCage(cageId) {
            // Remove previous selection
            if (selectedCage) {
                const prevSelected = document.querySelector(`[data-cage-id="${selectedCage}"]`);
                if (prevSelected) {
                    prevSelected.classList.remove('selected');
                }
            }
            
            // Add new selection
            selectedCage = cageId;
            const newSelected = document.querySelector(`[data-cage-id="${cageId}"]`);
            if (newSelected) {
                newSelected.classList.add('selected');
            }
            
            // Update info panel
            displayCageInfo(cageId);
        }

        function displayCageInfo(cageId) {
            const cage = cageData[cageId];
            const detailsContainer = document.getElementById('cage-details');
            
            if (!cage) {
                detailsContainer.innerHTML = '<div class="no-selection">No data available for this cage</div>';
                return;
            }
            
            const mouseCount = cage.mice.length;
            let statusClass = 'status-normal';
            
            if (cage.status.includes('Breeding')) {
                statusClass = 'status-breeding';
            } else if (cage.status.includes('Experimental') || cage.status.includes('Treatment') || cage.status.includes('CL')) {
                statusClass = 'status-experimental';
            } else if (cage.status.includes('Pending') || cage.status.includes('Genotyping')) {
                statusClass = 'status-pending';
            } else if (cage.status.includes('Post-Genotyping') || cage.status.includes('Genotyped')) {
                statusClass = 'status-genotyped';
            } else if (cage.status.includes('Redistributed') || cage.status.includes('Retention')) {
                statusClass = 'status-redistributed';
            }
            
            let deathsInfo = '';
            if (cage.deaths && cage.deaths.length > 0) {
                deathsInfo = `
                    <div class="death-info">
                        <strong>死亡记录 (${cage.deaths.length}只):</strong><br>
                        ${cage.deaths.map(death => 
                            `出生: ${death.birthDate}, 死亡: ${death.deathDate}`
                        ).join('<br>')}
                    </div>
                `;
            }
            
            let managementInfo = '';
            if (cage.managementNote) {
                managementInfo = `
                    <div class="management-note">
                        <strong>管理操作记录:</strong> ${cage.managementNote}
                    </div>
                `;
            }
            
            const html = `
                <div class="cage-info">
                    <h4>笼位编号: ${cageId}</h4>
                    <p><strong>小鼠数量:</strong> <span class="mouse-count">${mouseCount}只</span></p>
                    <p><strong>状态:</strong> <span class="cage-status ${statusClass}">${cage.status}</span></p>
                    ${cage.additionalInfo ? `<p><strong>补充信息:</strong> ${cage.additionalInfo}</p>` : ''}
                </div>
                
                <div class="cage-description">
                    <strong>笼位描述:</strong><br>
                    ${cage.description}
                </div>
                
                ${managementInfo}
                ${deathsInfo}
                
                ${cage.mice.some(mouse => mouse.treatment !== '无') ? 
                    `<div class="treatment-info">
                        <strong>⚠️ 处理信息:</strong> 该笼位包含已处理小鼠
                    </div>` : ''
                }
                
                <table class="mouse-table">
                    <thead>
                        <tr>
                            <th>小鼠编号</th>
                            <th>基因型</th>
                            <th>性别</th>
                            <th>年龄</th>
                            <th>出生日期</th>
                            <th>处理</th>
                            <th>备注</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${cage.mice.map(mouse => `
                            <tr>
                                <td><strong>${mouse.id}</strong></td>
                                <td><span class="genotype-badge ${cage.genotype}">${mouse.genotype}</span></td>
                                <td>${mouse.sex === 'Male' ? '雄' : mouse.sex === 'Female' ? '雌' : '未知'}</td>
                                <td>${mouse.age}</td>
                                <td class="birth-death-dates">${mouse.birthDate}</td>
                                <td>${mouse.treatment}</td>
                                <td>${mouse.notes}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            detailsContainer.innerHTML = html;
        }

        // Define the grids for areas 2 and 3
        const colsArea2 = ["A", "B", "C", "D", "E", "F", "G", "H"];
        const colsArea3 = ["A", "B", "C", "D", "E", "F", "G", "H"];
        const rows = ["9", "8", "7", "6", "5", "4", "3", "2", "1"];

        // Create all three grids
        createGrid1();
        createGridStandard("grid2", colsArea2, rows);
        createGridStandard("grid3", colsArea3, rows);
    </script>
</body>
</html>